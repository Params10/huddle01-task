{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst fountainEncoder_1 = __importDefault(require(\"./fountainEncoder\"));\n\nconst bytewords_1 = __importDefault(require(\"./bytewords\"));\n\nclass UREncoder {\n  constructor(_ur, maxFragmentLength, firstSeqNum, minFragmentLength) {\n    this.ur = _ur;\n    this.fountainEncoder = new fountainEncoder_1.default(_ur.cbor, maxFragmentLength, firstSeqNum, minFragmentLength);\n  }\n\n  get fragmentsLength() {\n    return this.fountainEncoder.fragmentsLength;\n  }\n\n  get fragments() {\n    return this.fountainEncoder.fragments;\n  }\n\n  get messageLength() {\n    return this.fountainEncoder.messageLength;\n  }\n\n  get cbor() {\n    return this.ur.cbor;\n  }\n\n  encodeWhole() {\n    return [...new Array(this.fragmentsLength)].map(() => this.nextPart());\n  }\n\n  nextPart() {\n    const part = this.fountainEncoder.nextPart();\n\n    if (this.fountainEncoder.isSinglePart()) {\n      return UREncoder.encodeSinglePart(this.ur);\n    } else {\n      return UREncoder.encodePart(this.ur.type, part);\n    }\n  }\n\n  static encodeUri(scheme, pathComponents) {\n    const path = pathComponents.join('/');\n    return [scheme, path].join(':');\n  }\n\n  static encodeUR(pathComponents) {\n    return UREncoder.encodeUri('ur', pathComponents);\n  }\n\n  static encodePart(type, part) {\n    const seq = `${part.seqNum}-${part.seqLength}`;\n    const body = bytewords_1.default.encode(part.cbor().toString('hex'), bytewords_1.default.STYLES.MINIMAL);\n    return UREncoder.encodeUR([type, seq, body]);\n  }\n\n  static encodeSinglePart(ur) {\n    const body = bytewords_1.default.encode(ur.cbor.toString('hex'), bytewords_1.default.STYLES.MINIMAL);\n    return UREncoder.encodeUR([ur.type, body]);\n  }\n\n}\n\nexports.default = UREncoder;","map":{"version":3,"sources":["../src/urEncoder.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,MAAA,iBAAA,GAAA,eAAA,CAAA,OAAA,CAAA,mBAAA,CAAA,CAAA;;AACA,MAAA,WAAA,GAAA,eAAA,CAAA,OAAA,CAAA,aAAA,CAAA,CAAA;;AAGA,MAAqB,SAArB,CAA8B;AAI5B,EAAA,WAAA,CACE,GADF,EAEE,iBAFF,EAGE,WAHF,EAIE,iBAJF,EAI4B;AAE1B,SAAK,EAAL,GAAU,GAAV;AACA,SAAK,eAAL,GAAuB,IAAI,iBAAA,CAAA,OAAJ,CAAoB,GAAG,CAAC,IAAxB,EAA8B,iBAA9B,EAAiD,WAAjD,EAA8D,iBAA9D,CAAvB;AACD;;AAEyB,MAAf,eAAe,GAAA;AAAK,WAAO,KAAK,eAAL,CAAqB,eAA5B;AAA8C;;AACzD,MAAT,SAAS,GAAA;AAAK,WAAO,KAAK,eAAL,CAAqB,SAA5B;AAAwC;;AACzC,MAAb,aAAa,GAAA;AAAK,WAAO,KAAK,eAAL,CAAqB,aAA5B;AAA4C;;AAC1D,MAAJ,IAAI,GAAA;AAAK,WAAO,KAAK,EAAL,CAAQ,IAAf;AAAsB;;AAEnC,EAAA,WAAW,GAAA;AAChB,WAAO,CAAC,GAAG,IAAI,KAAJ,CAAU,KAAK,eAAf,CAAJ,EAAqC,GAArC,CAAyC,MAAM,KAAK,QAAL,EAA/C,CAAP;AACD;;AAEM,EAAA,QAAQ,GAAA;AACb,UAAM,IAAI,GAAG,KAAK,eAAL,CAAqB,QAArB,EAAb;;AAEA,QAAI,KAAK,eAAL,CAAqB,YAArB,EAAJ,EAAyC;AACvC,aAAO,SAAS,CAAC,gBAAV,CAA2B,KAAK,EAAhC,CAAP;AACD,KAFD,MAGK;AACH,aAAO,SAAS,CAAC,UAAV,CAAqB,KAAK,EAAL,CAAQ,IAA7B,EAAmC,IAAnC,CAAP;AACD;AACF;;AAEuB,SAAT,SAAS,CAAC,MAAD,EAAiB,cAAjB,EAAyC;AAC/D,UAAM,IAAI,GAAG,cAAc,CAAC,IAAf,CAAoB,GAApB,CAAb;AACA,WAAO,CAAC,MAAD,EAAS,IAAT,EAAe,IAAf,CAAoB,GAApB,CAAP;AACD;;AAEsB,SAAR,QAAQ,CAAC,cAAD,EAAyB;AAC9C,WAAO,SAAS,CAAC,SAAV,CAAoB,IAApB,EAA0B,cAA1B,CAAP;AACD;;AAEwB,SAAV,UAAU,CAAC,IAAD,EAAe,IAAf,EAAwC;AAC/D,UAAM,GAAG,GAAG,GAAG,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,SAAS,EAA5C;AACA,UAAM,IAAI,GAAG,WAAA,CAAA,OAAA,CAAU,MAAV,CAAiB,IAAI,CAAC,IAAL,GAAY,QAAZ,CAAqB,KAArB,CAAjB,EAA8C,WAAA,CAAA,OAAA,CAAU,MAAV,CAAiB,OAA/D,CAAb;AAEA,WAAO,SAAS,CAAC,QAAV,CAAmB,CAAC,IAAD,EAAO,GAAP,EAAY,IAAZ,CAAnB,CAAP;AACD;;AAE6B,SAAhB,gBAAgB,CAAC,EAAD,EAAO;AACnC,UAAM,IAAI,GAAG,WAAA,CAAA,OAAA,CAAU,MAAV,CAAiB,EAAE,CAAC,IAAH,CAAQ,QAAR,CAAiB,KAAjB,CAAjB,EAA0C,WAAA,CAAA,OAAA,CAAU,MAAV,CAAiB,OAA3D,CAAb;AAEA,WAAO,SAAS,CAAC,QAAV,CAAmB,CAAC,EAAE,CAAC,IAAJ,EAAU,IAAV,CAAnB,CAAP;AACD;;AAtD2B;;AAA9B,OAAA,CAAA,OAAA,GAAA,SAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst fountainEncoder_1 = __importDefault(require(\"./fountainEncoder\"));\nconst bytewords_1 = __importDefault(require(\"./bytewords\"));\nclass UREncoder {\n    constructor(_ur, maxFragmentLength, firstSeqNum, minFragmentLength) {\n        this.ur = _ur;\n        this.fountainEncoder = new fountainEncoder_1.default(_ur.cbor, maxFragmentLength, firstSeqNum, minFragmentLength);\n    }\n    get fragmentsLength() { return this.fountainEncoder.fragmentsLength; }\n    get fragments() { return this.fountainEncoder.fragments; }\n    get messageLength() { return this.fountainEncoder.messageLength; }\n    get cbor() { return this.ur.cbor; }\n    encodeWhole() {\n        return [...new Array(this.fragmentsLength)].map(() => this.nextPart());\n    }\n    nextPart() {\n        const part = this.fountainEncoder.nextPart();\n        if (this.fountainEncoder.isSinglePart()) {\n            return UREncoder.encodeSinglePart(this.ur);\n        }\n        else {\n            return UREncoder.encodePart(this.ur.type, part);\n        }\n    }\n    static encodeUri(scheme, pathComponents) {\n        const path = pathComponents.join('/');\n        return [scheme, path].join(':');\n    }\n    static encodeUR(pathComponents) {\n        return UREncoder.encodeUri('ur', pathComponents);\n    }\n    static encodePart(type, part) {\n        const seq = `${part.seqNum}-${part.seqLength}`;\n        const body = bytewords_1.default.encode(part.cbor().toString('hex'), bytewords_1.default.STYLES.MINIMAL);\n        return UREncoder.encodeUR([type, seq, body]);\n    }\n    static encodeSinglePart(ur) {\n        const body = bytewords_1.default.encode(ur.cbor.toString('hex'), bytewords_1.default.STYLES.MINIMAL);\n        return UREncoder.encodeUR([ur.type, body]);\n    }\n}\nexports.default = UREncoder;\n//# sourceMappingURL=urEncoder.js.map"]},"metadata":{},"sourceType":"script"}