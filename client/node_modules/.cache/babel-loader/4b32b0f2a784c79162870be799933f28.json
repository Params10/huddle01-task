{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.disableWebUSB = exports.requestLogin = exports.customMessage = exports.getSettings = exports.renderWebUSBButton = exports.uiResponse = exports.call = exports.init = exports.cancel = exports.dispose = exports.manifest = exports.eventEmitter = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _events = _interopRequireDefault(require(\"events\"));\n\nvar _PopupManager = _interopRequireDefault(require(\"../../popup/PopupManager\"));\n\nvar iframe = _interopRequireWildcard(require(\"../../iframe/builder\"));\n\nvar _button = _interopRequireDefault(require(\"../../webusb/button\"));\n\nvar _message = require(\"../../message\");\n\nvar _builder2 = require(\"../../message/builder\");\n\nvar _ConnectSettings = require(\"../../data/ConnectSettings\");\n\nvar _debug = require(\"../../utils/debug\");\n\nvar _constants = require(\"../../constants\");\n\nvar $T = _interopRequireWildcard(require(\"../../types\"));\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2[\"default\"])(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar eventEmitter = new _events[\"default\"]();\nexports.eventEmitter = eventEmitter;\n\nvar _log = (0, _debug.initLog)('[trezor-connect.js]');\n\nvar _settings;\n\nvar _popupManager;\n\nvar initPopupManager = function initPopupManager() {\n  var pm = new _PopupManager[\"default\"](_settings);\n  pm.on(_constants.POPUP.CLOSED, function (error) {\n    iframe.postMessage({\n      type: _constants.POPUP.CLOSED,\n      payload: error ? {\n        error: error\n      } : null\n    }, false);\n  });\n  return pm;\n};\n\nvar manifest = function manifest(data) {\n  _settings = (0, _ConnectSettings.parse)({\n    manifest: data\n  });\n};\n\nexports.manifest = manifest;\n\nvar dispose = function dispose() {\n  eventEmitter.removeAllListeners();\n  iframe.dispose();\n\n  if (_popupManager) {\n    _popupManager.close();\n  }\n};\n\nexports.dispose = dispose;\n\nvar cancel = function cancel(error) {\n  if (_popupManager) {\n    _popupManager.emit(_constants.POPUP.CLOSED, error);\n  }\n}; // handle message received from iframe\n\n\nexports.cancel = cancel;\n\nvar handleMessage = function handleMessage(messageEvent) {\n  // ignore messages from domain other then iframe origin\n  if (messageEvent.origin !== iframe.origin) return;\n  var message = (0, _message.parseMessage)(messageEvent.data);\n  var event = message.event,\n      type = message.type,\n      payload = message.payload;\n  var id = message.id || 0;\n\n  _log.log('handleMessage', message);\n\n  switch (event) {\n    case _constants.RESPONSE_EVENT:\n      if (iframe.messagePromises[id]) {\n        // resolve message promise (send result of call method)\n        iframe.messagePromises[id].resolve({\n          id: id,\n          success: message.success,\n          payload: payload\n        });\n        delete iframe.messagePromises[id];\n      } else {\n        _log.warn(\"Unknown message id \" + id);\n      }\n\n      break;\n\n    case _constants.DEVICE_EVENT:\n      // pass DEVICE event up to html\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload); // DEVICE_EVENT also emit single events (connect/disconnect...)\n\n      break;\n\n    case _constants.TRANSPORT_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.BLOCKCHAIN_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.UI_EVENT:\n      if (type === _constants.IFRAME.BOOTSTRAP) {\n        iframe.clearTimeout();\n        break;\n      }\n\n      if (type === _constants.IFRAME.LOADED) {\n        iframe.initPromise.resolve();\n      }\n\n      if (type === _constants.IFRAME.ERROR) {\n        iframe.initPromise.reject(payload.error);\n      } // pass UI event up\n\n\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    default:\n      _log.log('Undefined message', event, messageEvent);\n\n  }\n};\n\nvar init = /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(settings) {\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (settings === void 0) {\n              settings = {};\n            }\n\n            if (!iframe.instance) {\n              _context.next = 3;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_AlreadyInitialized');\n\n          case 3:\n            if (!_settings) {\n              _settings = (0, _ConnectSettings.parse)(settings);\n            }\n\n            if (_settings.manifest) {\n              _context.next = 6;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_ManifestMissing');\n\n          case 6:\n            if (!_settings.lazyLoad) {\n              _context.next = 9;\n              break;\n            } // reset \"lazyLoad\" after first use\n\n\n            _settings.lazyLoad = false;\n            return _context.abrupt(\"return\");\n\n          case 9:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _log.enabled = !!_settings.debug;\n            window.addEventListener('message', handleMessage);\n            window.addEventListener('unload', dispose);\n            _context.next = 15;\n            return iframe.init(_settings);\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function init(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.init = init;\n\nvar call = /*#__PURE__*/function () {\n  var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(params) {\n    var response;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(!iframe.instance && !iframe.timeout)) {\n              _context2.next = 15;\n              break;\n            } // init popup with lazy loading before iframe initialization\n\n\n            _settings = (0, _ConnectSettings.parse)(_settings);\n\n            if (_settings.manifest) {\n              _context2.next = 4;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 4:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _popupManager.request(true); // auto init with default settings\n\n\n            _context2.prev = 6;\n            _context2.next = 9;\n            return init(_settings);\n\n          case 9:\n            _context2.next = 15;\n            break;\n\n          case 11:\n            _context2.prev = 11;\n            _context2.t0 = _context2[\"catch\"](6);\n\n            if (_popupManager) {\n              // Catch fatal iframe errors (not loading)\n              if (['Init_IframeBlocked', 'Init_IframeTimeout'].includes(_context2.t0.code)) {\n                _popupManager.postMessage((0, _builder2.UiMessage)(_constants.UI.IFRAME_FAILURE));\n              } else {\n                _popupManager.close();\n              }\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t0));\n\n          case 15:\n            if (!iframe.timeout) {\n              _context2.next = 17;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 17:\n            if (!iframe.error) {\n              _context2.next = 19;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(iframe.error));\n\n          case 19:\n            // request popup window it might be used in the future\n            if (_settings.popup && _popupManager) {\n              _popupManager.request();\n            } // post message to iframe\n\n\n            _context2.prev = 20;\n            _context2.next = 23;\n            return iframe.postMessage({\n              type: _constants.IFRAME.CALL,\n              payload: params\n            });\n\n          case 23:\n            response = _context2.sent;\n\n            if (!response) {\n              _context2.next = 27;\n              break;\n            }\n\n            if (!response.success && response.payload.error.code !== 'Device_CallInProgress' && _popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", response);\n\n          case 27:\n            if (_popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_NoResponse')));\n\n          case 31:\n            _context2.prev = 31;\n            _context2.t1 = _context2[\"catch\"](20);\n\n            _log.error('__call error', _context2.t1);\n\n            if (_popupManager) {\n              _popupManager.close();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t1));\n\n          case 36:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[6, 11], [20, 31]]);\n  }));\n\n  return function call(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.call = call;\n\nvar customMessageResponse = function customMessageResponse(payload) {\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.UI.CUSTOM_MESSAGE_RESPONSE,\n    payload: payload\n  });\n};\n\nvar uiResponse = function uiResponse(response) {\n  var type = response.type,\n      payload = response.payload;\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: type,\n    payload: payload\n  });\n};\n\nexports.uiResponse = uiResponse;\n\nvar renderWebUSBButton = function renderWebUSBButton(className) {\n  (0, _button[\"default\"])(className, _settings.webusbSrc, iframe.origin);\n};\n\nexports.renderWebUSBButton = renderWebUSBButton;\n\nvar getSettings = function getSettings() {\n  if (!iframe.instance) {\n    return Promise.resolve((0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_NotInitialized')));\n  }\n\n  return call({\n    method: 'getSettings'\n  });\n};\n\nexports.getSettings = getSettings;\n\nvar customMessage = /*#__PURE__*/function () {\n  var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(params) {\n    var callback, customMessageListener, response;\n    return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            if (!(typeof params.callback !== 'function')) {\n              _context4.next = 2;\n              break;\n            }\n\n            return _context4.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_CustomMessage_Callback')));\n\n          case 2:\n            // TODO: set message listener only if iframe is loaded correctly\n            callback = params.callback;\n\n            customMessageListener = /*#__PURE__*/function () {\n              var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.CUSTOM_MESSAGE_REQUEST)) {\n                          _context3.next = 6;\n                          break;\n                        }\n\n                        _context3.next = 4;\n                        return callback(data.payload);\n\n                      case 4:\n                        payload = _context3.sent;\n\n                        if (payload) {\n                          customMessageResponse(payload);\n                        } else {\n                          customMessageResponse({\n                            message: 'release'\n                          });\n                        }\n\n                      case 6:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3);\n              }));\n\n              return function customMessageListener(_x4) {\n                return _ref4.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', customMessageListener, false);\n            _context4.next = 7;\n            return call(_objectSpread(_objectSpread({\n              method: 'customMessage'\n            }, params), {}, {\n              callback: null\n            }));\n\n          case 7:\n            response = _context4.sent;\n            window.removeEventListener('message', customMessageListener);\n            return _context4.abrupt(\"return\", response);\n\n          case 10:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function customMessage(_x3) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexports.customMessage = customMessage;\n\nvar requestLogin = /*#__PURE__*/function () {\n  var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6(params) {\n    var callback, loginChallengeListener, response;\n    return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            if (!(typeof params.callback === 'function')) {\n              _context6.next = 9;\n              break;\n            }\n\n            callback = params.callback; // TODO: set message listener only if iframe is loaded correctly\n\n            loginChallengeListener = /*#__PURE__*/function () {\n              var _ref6 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n                  while (1) {\n                    switch (_context5.prev = _context5.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.LOGIN_CHALLENGE_REQUEST)) {\n                          _context5.next = 12;\n                          break;\n                        }\n\n                        _context5.prev = 2;\n                        _context5.next = 5;\n                        return callback();\n\n                      case 5:\n                        payload = _context5.sent;\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: payload\n                        });\n                        _context5.next = 12;\n                        break;\n\n                      case 9:\n                        _context5.prev = 9;\n                        _context5.t0 = _context5[\"catch\"](2);\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: _context5.t0.message\n                        });\n\n                      case 12:\n                      case \"end\":\n                        return _context5.stop();\n                    }\n                  }\n                }, _callee5, null, [[2, 9]]);\n              }));\n\n              return function loginChallengeListener(_x6) {\n                return _ref6.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', loginChallengeListener, false);\n            _context6.next = 6;\n            return call(_objectSpread(_objectSpread({\n              method: 'requestLogin'\n            }, params), {}, {\n              asyncChallenge: true,\n              callback: null\n            }));\n\n          case 6:\n            response = _context6.sent;\n            window.removeEventListener('message', loginChallengeListener);\n            return _context6.abrupt(\"return\", response);\n\n          case 9:\n            return _context6.abrupt(\"return\", call(_objectSpread({\n              method: 'requestLogin'\n            }, params)));\n\n          case 10:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n\n  return function requestLogin(_x5) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nexports.requestLogin = requestLogin;\n\nvar disableWebUSB = function disableWebUSB() {\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.TRANSPORT.DISABLE_WEBUSB\n  });\n};\n\nexports.disableWebUSB = disableWebUSB;","map":{"version":3,"sources":["/home/param/Desktop/huddle01-task/client/node_modules/trezor-connect/lib/env/browser/index.js"],"names":["_interopRequireWildcard","require","_interopRequireDefault","exports","__esModule","disableWebUSB","requestLogin","customMessage","getSettings","renderWebUSBButton","uiResponse","call","init","cancel","dispose","manifest","eventEmitter","_defineProperty2","_regenerator","_asyncToGenerator2","_events","_PopupManager","iframe","_button","_message","_builder2","_ConnectSettings","_debug","_constants","$T","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","_log","initLog","_settings","_popupManager","initPopupManager","pm","on","POPUP","CLOSED","error","postMessage","type","payload","data","parse","removeAllListeners","close","emit","handleMessage","messageEvent","origin","message","parseMessage","event","id","log","RESPONSE_EVENT","messagePromises","resolve","success","warn","DEVICE_EVENT","TRANSPORT_EVENT","BLOCKCHAIN_EVENT","UI_EVENT","IFRAME","BOOTSTRAP","clearTimeout","LOADED","initPromise","ERROR","reject","_ref","mark","_callee","settings","wrap","_callee$","_context","prev","next","instance","ERRORS","TypedError","lazyLoad","abrupt","enabled","debug","window","addEventListener","stop","_x","_ref2","_callee2","params","response","_callee2$","_context2","timeout","errorMessage","request","t0","includes","code","UiMessage","UI","IFRAME_FAILURE","popup","CALL","sent","unlock","t1","_x2","customMessageResponse","CUSTOM_MESSAGE_RESPONSE","className","webusbSrc","Promise","method","_ref3","_callee4","callback","customMessageListener","_callee4$","_context4","_ref4","_callee3","_callee3$","_context3","CUSTOM_MESSAGE_REQUEST","_x4","removeEventListener","_x3","_ref5","_callee6","loginChallengeListener","_callee6$","_context6","_ref6","_callee5","_callee5$","_context5","LOGIN_CHALLENGE_REQUEST","LOGIN_CHALLENGE_RESPONSE","_x6","asyncChallenge","_x5","TRANSPORT","DISABLE_WEBUSB"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.disableWebUSB = exports.requestLogin = exports.customMessage = exports.getSettings = exports.renderWebUSBButton = exports.uiResponse = exports.call = exports.init = exports.cancel = exports.dispose = exports.manifest = exports.eventEmitter = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _events = _interopRequireDefault(require(\"events\"));\n\nvar _PopupManager = _interopRequireDefault(require(\"../../popup/PopupManager\"));\n\nvar iframe = _interopRequireWildcard(require(\"../../iframe/builder\"));\n\nvar _button = _interopRequireDefault(require(\"../../webusb/button\"));\n\nvar _message = require(\"../../message\");\n\nvar _builder2 = require(\"../../message/builder\");\n\nvar _ConnectSettings = require(\"../../data/ConnectSettings\");\n\nvar _debug = require(\"../../utils/debug\");\n\nvar _constants = require(\"../../constants\");\n\nvar $T = _interopRequireWildcard(require(\"../../types\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar eventEmitter = new _events[\"default\"]();\nexports.eventEmitter = eventEmitter;\n\nvar _log = (0, _debug.initLog)('[trezor-connect.js]');\n\nvar _settings;\n\nvar _popupManager;\n\nvar initPopupManager = function initPopupManager() {\n  var pm = new _PopupManager[\"default\"](_settings);\n  pm.on(_constants.POPUP.CLOSED, function (error) {\n    iframe.postMessage({\n      type: _constants.POPUP.CLOSED,\n      payload: error ? {\n        error: error\n      } : null\n    }, false);\n  });\n  return pm;\n};\n\nvar manifest = function manifest(data) {\n  _settings = (0, _ConnectSettings.parse)({\n    manifest: data\n  });\n};\n\nexports.manifest = manifest;\n\nvar dispose = function dispose() {\n  eventEmitter.removeAllListeners();\n  iframe.dispose();\n\n  if (_popupManager) {\n    _popupManager.close();\n  }\n};\n\nexports.dispose = dispose;\n\nvar cancel = function cancel(error) {\n  if (_popupManager) {\n    _popupManager.emit(_constants.POPUP.CLOSED, error);\n  }\n}; // handle message received from iframe\n\n\nexports.cancel = cancel;\n\nvar handleMessage = function handleMessage(messageEvent) {\n  // ignore messages from domain other then iframe origin\n  if (messageEvent.origin !== iframe.origin) return;\n  var message = (0, _message.parseMessage)(messageEvent.data);\n  var event = message.event,\n      type = message.type,\n      payload = message.payload;\n  var id = message.id || 0;\n\n  _log.log('handleMessage', message);\n\n  switch (event) {\n    case _constants.RESPONSE_EVENT:\n      if (iframe.messagePromises[id]) {\n        // resolve message promise (send result of call method)\n        iframe.messagePromises[id].resolve({\n          id: id,\n          success: message.success,\n          payload: payload\n        });\n        delete iframe.messagePromises[id];\n      } else {\n        _log.warn(\"Unknown message id \" + id);\n      }\n\n      break;\n\n    case _constants.DEVICE_EVENT:\n      // pass DEVICE event up to html\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload); // DEVICE_EVENT also emit single events (connect/disconnect...)\n\n      break;\n\n    case _constants.TRANSPORT_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.BLOCKCHAIN_EVENT:\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    case _constants.UI_EVENT:\n      if (type === _constants.IFRAME.BOOTSTRAP) {\n        iframe.clearTimeout();\n        break;\n      }\n\n      if (type === _constants.IFRAME.LOADED) {\n        iframe.initPromise.resolve();\n      }\n\n      if (type === _constants.IFRAME.ERROR) {\n        iframe.initPromise.reject(payload.error);\n      } // pass UI event up\n\n\n      eventEmitter.emit(event, message);\n      eventEmitter.emit(type, payload);\n      break;\n\n    default:\n      _log.log('Undefined message', event, messageEvent);\n\n  }\n};\n\nvar init = /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(settings) {\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (settings === void 0) {\n              settings = {};\n            }\n\n            if (!iframe.instance) {\n              _context.next = 3;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_AlreadyInitialized');\n\n          case 3:\n            if (!_settings) {\n              _settings = (0, _ConnectSettings.parse)(settings);\n            }\n\n            if (_settings.manifest) {\n              _context.next = 6;\n              break;\n            }\n\n            throw _constants.ERRORS.TypedError('Init_ManifestMissing');\n\n          case 6:\n            if (!_settings.lazyLoad) {\n              _context.next = 9;\n              break;\n            }\n\n            // reset \"lazyLoad\" after first use\n            _settings.lazyLoad = false;\n            return _context.abrupt(\"return\");\n\n          case 9:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _log.enabled = !!_settings.debug;\n            window.addEventListener('message', handleMessage);\n            window.addEventListener('unload', dispose);\n            _context.next = 15;\n            return iframe.init(_settings);\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function init(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.init = init;\n\nvar call = /*#__PURE__*/function () {\n  var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(params) {\n    var response;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(!iframe.instance && !iframe.timeout)) {\n              _context2.next = 15;\n              break;\n            }\n\n            // init popup with lazy loading before iframe initialization\n            _settings = (0, _ConnectSettings.parse)(_settings);\n\n            if (_settings.manifest) {\n              _context2.next = 4;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 4:\n            if (!_popupManager) {\n              _popupManager = initPopupManager();\n            }\n\n            _popupManager.request(true); // auto init with default settings\n\n\n            _context2.prev = 6;\n            _context2.next = 9;\n            return init(_settings);\n\n          case 9:\n            _context2.next = 15;\n            break;\n\n          case 11:\n            _context2.prev = 11;\n            _context2.t0 = _context2[\"catch\"](6);\n\n            if (_popupManager) {\n              // Catch fatal iframe errors (not loading)\n              if (['Init_IframeBlocked', 'Init_IframeTimeout'].includes(_context2.t0.code)) {\n                _popupManager.postMessage((0, _builder2.UiMessage)(_constants.UI.IFRAME_FAILURE));\n              } else {\n                _popupManager.close();\n              }\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t0));\n\n          case 15:\n            if (!iframe.timeout) {\n              _context2.next = 17;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_ManifestMissing')));\n\n          case 17:\n            if (!iframe.error) {\n              _context2.next = 19;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(iframe.error));\n\n          case 19:\n            // request popup window it might be used in the future\n            if (_settings.popup && _popupManager) {\n              _popupManager.request();\n            } // post message to iframe\n\n\n            _context2.prev = 20;\n            _context2.next = 23;\n            return iframe.postMessage({\n              type: _constants.IFRAME.CALL,\n              payload: params\n            });\n\n          case 23:\n            response = _context2.sent;\n\n            if (!response) {\n              _context2.next = 27;\n              break;\n            }\n\n            if (!response.success && response.payload.error.code !== 'Device_CallInProgress' && _popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", response);\n\n          case 27:\n            if (_popupManager) {\n              _popupManager.unlock();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_NoResponse')));\n\n          case 31:\n            _context2.prev = 31;\n            _context2.t1 = _context2[\"catch\"](20);\n\n            _log.error('__call error', _context2.t1);\n\n            if (_popupManager) {\n              _popupManager.close();\n            }\n\n            return _context2.abrupt(\"return\", (0, _message.errorMessage)(_context2.t1));\n\n          case 36:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[6, 11], [20, 31]]);\n  }));\n\n  return function call(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexports.call = call;\n\nvar customMessageResponse = function customMessageResponse(payload) {\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.UI.CUSTOM_MESSAGE_RESPONSE,\n    payload: payload\n  });\n};\n\nvar uiResponse = function uiResponse(response) {\n  var type = response.type,\n      payload = response.payload;\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: type,\n    payload: payload\n  });\n};\n\nexports.uiResponse = uiResponse;\n\nvar renderWebUSBButton = function renderWebUSBButton(className) {\n  (0, _button[\"default\"])(className, _settings.webusbSrc, iframe.origin);\n};\n\nexports.renderWebUSBButton = renderWebUSBButton;\n\nvar getSettings = function getSettings() {\n  if (!iframe.instance) {\n    return Promise.resolve((0, _message.errorMessage)(_constants.ERRORS.TypedError('Init_NotInitialized')));\n  }\n\n  return call({\n    method: 'getSettings'\n  });\n};\n\nexports.getSettings = getSettings;\n\nvar customMessage = /*#__PURE__*/function () {\n  var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(params) {\n    var callback, customMessageListener, response;\n    return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            if (!(typeof params.callback !== 'function')) {\n              _context4.next = 2;\n              break;\n            }\n\n            return _context4.abrupt(\"return\", (0, _message.errorMessage)(_constants.ERRORS.TypedError('Method_CustomMessage_Callback')));\n\n          case 2:\n            // TODO: set message listener only if iframe is loaded correctly\n            callback = params.callback;\n\n            customMessageListener = /*#__PURE__*/function () {\n              var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.CUSTOM_MESSAGE_REQUEST)) {\n                          _context3.next = 6;\n                          break;\n                        }\n\n                        _context3.next = 4;\n                        return callback(data.payload);\n\n                      case 4:\n                        payload = _context3.sent;\n\n                        if (payload) {\n                          customMessageResponse(payload);\n                        } else {\n                          customMessageResponse({\n                            message: 'release'\n                          });\n                        }\n\n                      case 6:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3);\n              }));\n\n              return function customMessageListener(_x4) {\n                return _ref4.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', customMessageListener, false);\n            _context4.next = 7;\n            return call(_objectSpread(_objectSpread({\n              method: 'customMessage'\n            }, params), {}, {\n              callback: null\n            }));\n\n          case 7:\n            response = _context4.sent;\n            window.removeEventListener('message', customMessageListener);\n            return _context4.abrupt(\"return\", response);\n\n          case 10:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function customMessage(_x3) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexports.customMessage = customMessage;\n\nvar requestLogin = /*#__PURE__*/function () {\n  var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6(params) {\n    var callback, loginChallengeListener, response;\n    return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            if (!(typeof params.callback === 'function')) {\n              _context6.next = 9;\n              break;\n            }\n\n            callback = params.callback; // TODO: set message listener only if iframe is loaded correctly\n\n            loginChallengeListener = /*#__PURE__*/function () {\n              var _ref6 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(event) {\n                var data, payload;\n                return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n                  while (1) {\n                    switch (_context5.prev = _context5.next) {\n                      case 0:\n                        data = event.data;\n\n                        if (!(data && data.type === _constants.UI.LOGIN_CHALLENGE_REQUEST)) {\n                          _context5.next = 12;\n                          break;\n                        }\n\n                        _context5.prev = 2;\n                        _context5.next = 5;\n                        return callback();\n\n                      case 5:\n                        payload = _context5.sent;\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: payload\n                        });\n                        _context5.next = 12;\n                        break;\n\n                      case 9:\n                        _context5.prev = 9;\n                        _context5.t0 = _context5[\"catch\"](2);\n                        iframe.postMessage({\n                          event: _constants.UI_EVENT,\n                          type: _constants.UI.LOGIN_CHALLENGE_RESPONSE,\n                          payload: _context5.t0.message\n                        });\n\n                      case 12:\n                      case \"end\":\n                        return _context5.stop();\n                    }\n                  }\n                }, _callee5, null, [[2, 9]]);\n              }));\n\n              return function loginChallengeListener(_x6) {\n                return _ref6.apply(this, arguments);\n              };\n            }();\n\n            window.addEventListener('message', loginChallengeListener, false);\n            _context6.next = 6;\n            return call(_objectSpread(_objectSpread({\n              method: 'requestLogin'\n            }, params), {}, {\n              asyncChallenge: true,\n              callback: null\n            }));\n\n          case 6:\n            response = _context6.sent;\n            window.removeEventListener('message', loginChallengeListener);\n            return _context6.abrupt(\"return\", response);\n\n          case 9:\n            return _context6.abrupt(\"return\", call(_objectSpread({\n              method: 'requestLogin'\n            }, params)));\n\n          case 10:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n\n  return function requestLogin(_x5) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nexports.requestLogin = requestLogin;\n\nvar disableWebUSB = function disableWebUSB() {\n  iframe.postMessage({\n    event: _constants.UI_EVENT,\n    type: _constants.TRANSPORT.DISABLE_WEBUSB\n  });\n};\n\nexports.disableWebUSB = disableWebUSB;"]},"metadata":{},"sourceType":"script"}