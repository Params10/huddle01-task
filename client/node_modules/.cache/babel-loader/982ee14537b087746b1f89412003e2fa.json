{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Keyring = void 0;\n\nconst eventemitter2 = __importStar(require(\"eventemitter2\"));\n\nclass Keyring extends eventemitter2.EventEmitter2 {\n  constructor() {\n    super({\n      wildcard: true\n    });\n    this.wallets = {};\n    this.aliases = {};\n  }\n\n  add(wallet, deviceID) {\n    const id = deviceID || new Date().toString();\n\n    if (!this.wallets[id]) {\n      this.wallets[id] = wallet;\n      wallet.transport && this.decorateEvents(id, wallet.transport);\n      return true;\n    }\n\n    return false;\n  }\n\n  addAlias(aliasee, alias) {\n    this.aliases[alias] = aliasee;\n  }\n\n  getAlias(aliasee) {\n    const keys = Object.keys(this.aliases);\n    const values = Object.values(this.aliases);\n    const index = values.indexOf(aliasee);\n    if (index !== -1) return keys[index];\n    return aliasee;\n  }\n\n  exec(method, ...args) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return Promise.all(Object.values(this.wallets).map(w => {\n        const fn = w[method];\n        if (typeof fn !== \"function\") throw new Error(`can't exec non-existent method ${method}`);\n        return fn.call(w, ...args);\n      })).then(values => values.reduce((final, response, i) => {\n        final[Object.keys(this.wallets)[i]] = response;\n        return final;\n      }, {}));\n    });\n  }\n\n  get(deviceID) {\n    if (deviceID && this.aliases[deviceID] && this.wallets[this.aliases[deviceID]]) return this.wallets[this.aliases[deviceID]];\n    if (deviceID && this.wallets[deviceID]) return this.wallets[deviceID];\n    if (!!Object.keys(this.wallets).length && !deviceID) return Object.values(this.wallets)[0];\n    return null;\n  }\n\n  remove(deviceID) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const wallet = this.get(deviceID);\n      if (!wallet) return;\n\n      try {\n        yield wallet.disconnect();\n      } catch (e) {\n        console.error(e);\n      } finally {\n        let aliasee = this.aliases[deviceID];\n\n        if (aliasee) {\n          delete this.aliases[deviceID];\n          delete this.wallets[aliasee];\n        } else {\n          delete this.wallets[deviceID];\n        }\n      }\n    });\n  }\n\n  removeAll() {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield Promise.all(Object.keys(this.wallets).map(this.remove.bind(this)));\n      this.aliases = {};\n    });\n  }\n\n  disconnectAll() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const wallets = Object.values(this.wallets);\n\n      for (let i = 0; i < wallets.length; i++) {\n        yield wallets[i].disconnect();\n      }\n    });\n  }\n\n  decorateEvents(deviceID, events) {\n    const wallet = this.get(deviceID);\n    if (!wallet) return;\n    const vendor = wallet.getVendor();\n    events.onAny((e, ...values) => this.emit([vendor, deviceID, typeof e === \"string\" ? e : e.join(\";\")], [deviceID, ...values]));\n  }\n\n}\n\nexports.Keyring = Keyring;","map":{"version":3,"sources":["../src/keyring.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Keyring = void 0;\nconst eventemitter2 = __importStar(require(\"eventemitter2\"));\nclass Keyring extends eventemitter2.EventEmitter2 {\n    constructor() {\n        super({ wildcard: true });\n        this.wallets = {};\n        this.aliases = {};\n    }\n    add(wallet, deviceID) {\n        const id = deviceID || new Date().toString();\n        if (!this.wallets[id]) {\n            this.wallets[id] = wallet;\n            wallet.transport && this.decorateEvents(id, wallet.transport);\n            return true;\n        }\n        return false;\n    }\n    addAlias(aliasee, alias) {\n        this.aliases[alias] = aliasee;\n    }\n    getAlias(aliasee) {\n        const keys = Object.keys(this.aliases);\n        const values = Object.values(this.aliases);\n        const index = values.indexOf(aliasee);\n        if (index !== -1)\n            return keys[index];\n        return aliasee;\n    }\n    exec(method, ...args) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return Promise.all(Object.values(this.wallets).map((w) => {\n                const fn = w[method];\n                if (typeof fn !== \"function\")\n                    throw new Error(`can't exec non-existent method ${method}`);\n                return fn.call(w, ...args);\n            })).then((values) => values.reduce((final, response, i) => {\n                final[Object.keys(this.wallets)[i]] = response;\n                return final;\n            }, {}));\n        });\n    }\n    get(deviceID) {\n        if (deviceID && this.aliases[deviceID] && this.wallets[this.aliases[deviceID]])\n            return this.wallets[this.aliases[deviceID]];\n        if (deviceID && this.wallets[deviceID])\n            return this.wallets[deviceID];\n        if (!!Object.keys(this.wallets).length && !deviceID)\n            return Object.values(this.wallets)[0];\n        return null;\n    }\n    remove(deviceID) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const wallet = this.get(deviceID);\n            if (!wallet)\n                return;\n            try {\n                yield wallet.disconnect();\n            }\n            catch (e) {\n                console.error(e);\n            }\n            finally {\n                let aliasee = this.aliases[deviceID];\n                if (aliasee) {\n                    delete this.aliases[deviceID];\n                    delete this.wallets[aliasee];\n                }\n                else {\n                    delete this.wallets[deviceID];\n                }\n            }\n        });\n    }\n    removeAll() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield Promise.all(Object.keys(this.wallets).map(this.remove.bind(this)));\n            this.aliases = {};\n        });\n    }\n    disconnectAll() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const wallets = Object.values(this.wallets);\n            for (let i = 0; i < wallets.length; i++) {\n                yield wallets[i].disconnect();\n            }\n        });\n    }\n    decorateEvents(deviceID, events) {\n        const wallet = this.get(deviceID);\n        if (!wallet)\n            return;\n        const vendor = wallet.getVendor();\n        events.onAny((e, ...values) => this.emit([vendor, deviceID, (typeof e === \"string\" ? e : e.join(\";\"))], [deviceID, ...values]));\n    }\n}\nexports.Keyring = Keyring;\n//# sourceMappingURL=keyring.js.map"]},"metadata":{},"sourceType":"script"}