{"ast":null,"code":"var _jsxFileName = \"/home/param/Desktop/huddle01-task/client/src/containers/Room.js\",\n    _s = $RefreshSig$();\n\n//client sdk import\nimport HuddleClient, { emitter } from \"huddle01-client\"; //react imports\n\nimport { useEffect, useState, useRef } from \"react\";\nimport { useHistory } from \"react-router-dom\"; //helper imports\n\nimport { getTrack } from \"../lib/utils/helpers\";\nimport { PeerVideo, PeerAudio, PeerScreen } from \"../components/PeerViewPort\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Room() {\n  _s();\n\n  const history = useHistory(); //to allow for recordings\n\n  const isBot = localStorage.getItem(\"bot_password\") === \"huddle01\"; //initialising states\n\n  const [huddle, setHuddle] = useState(null);\n  const [roomState, setRoomState] = useState(false);\n  const [micState, setMicState] = useState(false);\n  const [webcamState, setWebcamState] = useState(false);\n  const [screenshareState, setScreenshareState] = useState(false);\n  const [isHost, setIsHost] = useState(true);\n  const [beginTime, setBeginTime] = useState(new Date());\n  let hostid = \"\";\n  const [peers, setPeers] = useState([]);\n  const [consumerStreams, setConsumerStreams] = useState({\n    video: [],\n    audio: [],\n    screen: []\n  });\n  const meVideoElem = useRef(null);\n  const meScreenElem = useRef(null);\n  const joinRoomBtn = useRef(null);\n  const config = {\n    apiKey: \"i4pzqbpxza8vpijQMwZsP1H7nZZEH0TN3vR4NdNS\",\n    roomId: \"C131\",\n    peerId: \"Rick\" + Math.floor(Math.random() * 4000),\n    displayName: \"Rick Sanchez\",\n    window,\n    isBot // true/false -- gets calculated on line 15\n\n  }; //initialize the app\n\n  useEffect(() => {\n    history.push(`?roomId=${config.roomId}`);\n    const myHuddleClient = new HuddleClient(config);\n    setHuddle(myHuddleClient);\n  }, []);\n  useEffect(() => {\n    console.log(\"peers array \", peers);\n\n    if (huddle) {\n      console.log(huddle);\n\n      if (huddle._hostId) {\n        if (huddle._hostId != huddle._peerId) {\n          setIsHost(false);\n        }\n      }\n    }\n  }, [peers, huddle]); //recording config\n\n  useEffect(() => {\n    //joinRoomBtn here can be whatever button/function used that calls `huddle.join()`\n    huddle && isBot && joinRoomBtn.current.click();\n  }, [huddle, isBot]);\n\n  const setupEventListeners = async () => {\n    emitter.on(\"roomState\", state => {\n      switch (state) {\n        case \"connected\":\n          //do whatever\n          break;\n\n        case \"failed\":\n          //do whatever\n          break;\n\n        case \"disconnected\":\n          //do whatever\n          break;\n\n        default:\n          break;\n      }\n\n      setRoomState(state);\n    });\n    emitter.on(\"error\", error => {\n      alert(error); //do whatever\n    });\n    emitter.on(\"addPeer\", peer => {\n      console.log(\"new peer =>\", peer);\n      setPeers(_peers => [..._peers, peer]);\n    });\n    emitter.on(\"addProducer\", producer => {\n      console.log(\"new prod\", producer);\n\n      switch (producer.type) {\n        case \"webcam\":\n          let videoStream = producer.track;\n\n          if (typeof videoStream == \"object\") {\n            try {\n              meVideoElem.current.srcObject = getTrack(videoStream);\n            } catch (error) {\n              console.error(error);\n            }\n          }\n\n          break;\n\n        case \"mic\":\n          //do whatever\n          break;\n\n        case \"screen\":\n          videoStream = producer.track;\n\n          if (typeof videoStream == \"object\") {\n            try {\n              meScreenElem.current.srcObject = getTrack(videoStream);\n            } catch (error) {\n              console.error(error);\n            }\n          }\n\n          break;\n\n        default:\n          break;\n      }\n    });\n    emitter.on(\"removeProducer\", producer => {\n      console.log(\"remove \", producer);\n\n      switch (producer.type) {\n        case \"webcam\":\n          try {\n            meVideoElem.current.srcObject = null;\n          } catch (error) {\n            console.error(error);\n          }\n\n          break;\n\n        case \"mic\":\n          //do whatever\n          break;\n\n        case \"screen\":\n          try {\n            meScreenElem.current.srcObject = null;\n          } catch (error) {\n            console.error(error);\n          }\n\n          break;\n\n        default:\n          break;\n      }\n    });\n    emitter.on(\"addConsumer\", consumer => {\n      switch (consumer.type) {\n        case \"webcam\":\n          {\n            const videoStream = consumer.track;\n            setConsumerStreams(prevState => ({ ...prevState,\n              video: [...prevState.video, videoStream]\n            }));\n            break;\n          }\n\n        case \"screen\":\n          {\n            const screenStream = consumer.track;\n            setConsumerStreams(prevState => ({ ...prevState,\n              screen: [...prevState.screen, screenStream]\n            }));\n            break;\n          }\n\n        case \"mic\":\n          {\n            const audioStream = consumer.track;\n            setConsumerStreams(prevState => ({ ...prevState,\n              audio: [...prevState.audio, audioStream]\n            }));\n            break;\n          }\n\n        default:\n          break;\n      }\n    });\n    emitter.on(\"removeConsumer\", consumer => {\n      switch (consumer.type) {\n        case \"screen\":\n          setConsumerStreams(prevState => {\n            return { ...prevState,\n              screen: prevState.screen.filter(_consumer => _consumer.id !== consumer._id)\n            };\n          });\n          break;\n\n        case \"webcam\":\n          setConsumerStreams(prevState => {\n            return { ...prevState,\n              video: prevState.video.filter(_consumer => _consumer.id !== consumer._id)\n            };\n          });\n          break;\n\n        case \"mic\":\n          setConsumerStreams(prevState => {\n            return { ...prevState,\n              audio: prevState.audio.filter(_consumer => _consumer.id !== consumer._id)\n            };\n          });\n          break;\n\n        default:\n          break;\n      }\n    });\n  };\n\n  const joinRoom = async () => {\n    if (!huddle) return;\n\n    try {\n      setupEventListeners();\n      await huddle.join();\n      console.log(\"post join\", huddle);\n      setBeginTime(new Date());\n    } catch (error) {\n      alert(error);\n    }\n  };\n\n  const leaveRoom = async () => {\n    if (!huddle) return;\n\n    try {\n      await huddle.close();\n      setRoomState(false);\n      var secondBetweenTwoDate = Math.abs((new Date().getTime() - beginTime.getTime()) / 1000);\n      console.log(secondBetweenTwoDate);\n    } catch (error) {\n      alert(error);\n    }\n  }; //TODO: add pauseWebcam() and resumeWebcam()\n\n\n  const enableWebcam = async () => {\n    if (!huddle) return;\n\n    try {\n      await huddle.enableWebcam();\n      setWebcamState(true);\n    } catch (error) {\n      setWebcamState(false);\n      alert(error);\n    }\n  };\n\n  const disableWebcam = async () => {\n    if (!huddle) return;\n\n    try {\n      await huddle.disableWebcam();\n      setWebcamState(false);\n    } catch (error) {\n      alert(error);\n    }\n  };\n\n  const startScreenshare = async () => {\n    if (!huddle) return;\n\n    try {\n      await huddle.enableShare();\n      setScreenshareState(true);\n    } catch (error) {\n      alert(error);\n      setScreenshareState(false);\n    }\n  };\n\n  const stopScreenshare = async () => {\n    if (!huddle) return;\n\n    try {\n      await huddle.disableShare();\n      setScreenshareState(false);\n    } catch (error) {\n      alert(error);\n    }\n  }; //TODO: add muteMic() and unmuteMic()\n\n\n  const enableMic = async () => {\n    if (!huddle) return;\n\n    try {\n      huddle.enableMic();\n      setMicState(true);\n    } catch (error) {\n      setMicState(false);\n      alert(error);\n    }\n  };\n\n  const disableMic = async () => {\n    if (!huddle) return;\n\n    try {\n      huddle.disableMic();\n      setMicState(false);\n    } catch (error) {\n      alert(error);\n      setMicState(true);\n    }\n  };\n\n  const startRecording = async () => {\n    if (!huddle) return;\n\n    try {\n      const status = await huddle.startRecording();\n      if (status) console.log(\"recording successfully initiated\");\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  const stopRecorder = async () => {\n    if (!huddle) return;\n\n    try {\n      const status = await huddle.stopRecording();\n      if (status) console.log(\"recording successfully stopped\");\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"me-ports\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        height: \"400px\",\n        width: \"400px\",\n        autoPlay: true,\n        ref: meVideoElem\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 352,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n        height: \"400px\",\n        width: \"400px\",\n        autoPlay: true,\n        ref: meScreenElem\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"btn-grp\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        ref: joinRoomBtn,\n        id: \"join-btn\",\n        onClick: roomState === \"connected\" ? leaveRoom : joinRoom,\n        children: roomState === \"connected\" ? \"Leave Room\" : \"Join Room\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: webcamState ? disableWebcam : enableWebcam,\n        disabled: !isHost,\n        children: webcamState ? \"Disable Webcam\" : \"Enable Webcam\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 364,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: micState ? disableMic : enableMic,\n        disabled: !isHost,\n        children: micState ? \"Disable Mic\" : \"Enable Mic\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: screenshareState ? stopScreenshare : startScreenshare,\n        disabled: !isHost,\n        children: screenshareState ? \"Disable Screenshare\" : \"Enable Screenshare\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 370,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 355,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"peer-ports\",\n      children: [consumerStreams.video.map((stream, idx) => {\n        return /*#__PURE__*/_jsxDEV(PeerVideo, {\n          videoTrack: getTrack(stream)\n        }, idx, false, {\n          fileName: _jsxFileName,\n          lineNumber: 378,\n          columnNumber: 28\n        }, this);\n      }), consumerStreams.screen.map((stream, idx) => {\n        return /*#__PURE__*/_jsxDEV(PeerScreen, {\n          screenTrack: getTrack(stream)\n        }, idx, false, {\n          fileName: _jsxFileName,\n          lineNumber: 381,\n          columnNumber: 28\n        }, this);\n      }), consumerStreams.audio.map((stream, idx) => {\n        return /*#__PURE__*/_jsxDEV(PeerAudio, {\n          audioTrack: getTrack(stream)\n        }, idx, false, {\n          fileName: _jsxFileName,\n          lineNumber: 384,\n          columnNumber: 28\n        }, this);\n      })]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 350,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Room, \"VV3b5hTBtM1SFxZK5Op3WqT+lJc=\", false, function () {\n  return [useHistory];\n});\n\n_c = Room;\nexport default Room;\n\nvar _c;\n\n$RefreshReg$(_c, \"Room\");","map":{"version":3,"sources":["/home/param/Desktop/huddle01-task/client/src/containers/Room.js"],"names":["HuddleClient","emitter","useEffect","useState","useRef","useHistory","getTrack","PeerVideo","PeerAudio","PeerScreen","Room","history","isBot","localStorage","getItem","huddle","setHuddle","roomState","setRoomState","micState","setMicState","webcamState","setWebcamState","screenshareState","setScreenshareState","isHost","setIsHost","beginTime","setBeginTime","Date","hostid","peers","setPeers","consumerStreams","setConsumerStreams","video","audio","screen","meVideoElem","meScreenElem","joinRoomBtn","config","apiKey","roomId","peerId","Math","floor","random","displayName","window","push","myHuddleClient","console","log","_hostId","_peerId","current","click","setupEventListeners","on","state","error","alert","peer","_peers","producer","type","videoStream","track","srcObject","consumer","prevState","screenStream","audioStream","filter","_consumer","id","_id","joinRoom","join","leaveRoom","close","secondBetweenTwoDate","abs","getTime","enableWebcam","disableWebcam","startScreenshare","enableShare","stopScreenshare","disableShare","enableMic","disableMic","startRecording","status","stopRecorder","stopRecording","map","stream","idx"],"mappings":"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","sourcesContent":["//client sdk import\nimport HuddleClient, { emitter } from \"huddle01-client\";\n\n//react imports\nimport { useEffect, useState, useRef } from \"react\";\nimport { useHistory } from \"react-router-dom\";\n\n//helper imports\nimport { getTrack } from \"../lib/utils/helpers\";\nimport { PeerVideo, PeerAudio, PeerScreen } from \"../components/PeerViewPort\";\n\nfunction Room() {\n    const history = useHistory();\n    //to allow for recordings\n    const isBot = localStorage.getItem(\"bot_password\") === \"huddle01\";\n    //initialising states\n    const [huddle, setHuddle] = useState(null);\n    const [roomState, setRoomState] = useState(false);\n    const [micState, setMicState] = useState(false);\n    const [webcamState, setWebcamState] = useState(false);\n    const [screenshareState, setScreenshareState] = useState(false);\n    const [isHost, setIsHost] = useState(true);\n    const [beginTime, setBeginTime] = useState(new Date());\n\n\n    let hostid = \"\";\n    const [peers, setPeers] = useState([]);\n    const [consumerStreams, setConsumerStreams] = useState({\n        video: [],\n        audio: [],\n        screen: [],\n    });\n\n    const meVideoElem = useRef(null);\n    const meScreenElem = useRef(null);\n    const joinRoomBtn = useRef(null);\n\n    const config = {\n        apiKey: \"i4pzqbpxza8vpijQMwZsP1H7nZZEH0TN3vR4NdNS\",\n        roomId: \"C131\",\n        peerId: \"Rick\" + Math.floor(Math.random() * 4000),\n        displayName: \"Rick Sanchez\",\n        window,\n        isBot, // true/false -- gets calculated on line 15\n    };\n\n    //initialize the app\n    useEffect(() => {\n        history.push(`?roomId=${config.roomId}`);\n\n        const myHuddleClient = new HuddleClient(config);\n        setHuddle(myHuddleClient);\n       \n    }, []);\n    useEffect(() => {\n        console.log(\"peers array \", peers);\n        if(huddle){\n            console.log(huddle);\n            if(huddle._hostId){\n                if(huddle._hostId!=huddle._peerId)\n                {\n                    setIsHost(false);\n                }\n            }\n        }\n        \n    }, [peers,huddle]);\n\n    //recording config\n    useEffect(() => {\n        //joinRoomBtn here can be whatever button/function used that calls `huddle.join()`\n        huddle && isBot && joinRoomBtn.current.click();\n    }, [huddle, isBot]);\n\n    const setupEventListeners = async () => {\n        emitter.on(\"roomState\", (state) => {\n            switch (state) {\n                case \"connected\":\n                    //do whatever\n                    break;\n                case \"failed\":\n                    //do whatever\n                    break;\n                case \"disconnected\":\n                    //do whatever\n                    break;\n                default:\n                    break;\n            }\n            setRoomState(state);\n        });\n\n        emitter.on(\"error\", (error) => {\n            alert(error);\n            //do whatever\n        });\n\n        emitter.on(\"addPeer\", (peer) => {\n            console.log(\"new peer =>\", peer);\n            setPeers((_peers) => [..._peers, peer]);\n        });\n\n        emitter.on(\"addProducer\", (producer) => {\n            console.log(\"new prod\", producer);\n            switch (producer.type) {\n                case \"webcam\":\n                    let videoStream = producer.track;\n                    if (typeof videoStream == \"object\") {\n                        try {\n                            meVideoElem.current.srcObject = getTrack(videoStream);\n                        } catch (error) {\n                            console.error(error);\n                        }\n                    }\n                    break;\n                case \"mic\":\n                    //do whatever\n                    break;\n                case \"screen\":\n                    videoStream = producer.track;\n                    if (typeof videoStream == \"object\") {\n                        try {\n                            meScreenElem.current.srcObject = getTrack(videoStream);\n                        } catch (error) {\n                            console.error(error);\n                        }\n                    }\n                    break;\n\n                default:\n                    break;\n            }\n        });\n\n        emitter.on(\"removeProducer\", (producer) => {\n            console.log(\"remove \", producer);\n            switch (producer.type) {\n                case \"webcam\":\n                    try {\n                        meVideoElem.current.srcObject = null;\n                    } catch (error) {\n                        console.error(error);\n                    }\n                    break;\n                case \"mic\":\n                    //do whatever\n                    break;\n                case \"screen\":\n                    try {\n                        meScreenElem.current.srcObject = null;\n                    } catch (error) {\n                        console.error(error);\n                    }\n                    break;\n\n                default:\n                    break;\n            }\n        });\n\n        emitter.on(\"addConsumer\", (consumer) => {\n            switch (consumer.type) {\n                case \"webcam\": {\n                    const videoStream = consumer.track;\n                    setConsumerStreams((prevState) => ({\n                        ...prevState,\n                        video: [...prevState.video, videoStream],\n                    }));\n\n                    break;\n                }\n\n                case \"screen\": {\n                    const screenStream = consumer.track;\n                    setConsumerStreams((prevState) => ({\n                        ...prevState,\n                        screen: [...prevState.screen, screenStream],\n                    }));\n                    break;\n                }\n\n                case \"mic\": {\n                    const audioStream = consumer.track;\n                    setConsumerStreams((prevState) => ({\n                        ...prevState,\n                        audio: [...prevState.audio, audioStream],\n                    }));\n\n                    break;\n                }\n\n                default:\n                    break;\n            }\n        });\n\n        emitter.on(\"removeConsumer\", (consumer) => {\n            switch (consumer.type) {\n                case \"screen\":\n                    setConsumerStreams((prevState) => {\n                        return {\n                            ...prevState,\n                            screen: prevState.screen.filter(\n                                (_consumer) => _consumer.id !== consumer._id\n                            ),\n                        };\n                    });\n                    break;\n                case \"webcam\":\n                    setConsumerStreams((prevState) => {\n                        return {\n                            ...prevState,\n                            video: prevState.video.filter(\n                                (_consumer) => _consumer.id !== consumer._id\n                            ),\n                        };\n                    });\n                    break;\n                case \"mic\":\n                    setConsumerStreams((prevState) => {\n                        return {\n                            ...prevState,\n                            audio: prevState.audio.filter(\n                                (_consumer) => _consumer.id !== consumer._id\n                            ),\n                        };\n                    });\n                    break;\n\n                default:\n                    break;\n            }\n        });\n    };\n\n    const joinRoom = async () => {\n        \n        if (!huddle) \n           return;\n        try {\n            setupEventListeners();\n            await huddle.join();\n            console.log(\"post join\",huddle);\n            setBeginTime(new Date());\n        } catch (error) {\n            alert(error);\n        }\n    };\n\n    const leaveRoom = async () => {\n\n        if (!huddle) return;\n        try {\n            await huddle.close();\n            setRoomState(false);\n            var secondBetweenTwoDate = Math.abs((new Date().getTime() - beginTime.getTime()) / 1000)\n            console.log(secondBetweenTwoDate);\n        } catch (error) {\n            alert(error);\n        }\n    };\n\n    //TODO: add pauseWebcam() and resumeWebcam()\n    const enableWebcam = async () => {\n        if (!huddle) return;\n        try {\n            await huddle.enableWebcam();\n            setWebcamState(true);\n        } catch (error) {\n            setWebcamState(false);\n            alert(error);\n        }\n    };\n\n    const disableWebcam = async () => {\n        if (!huddle) return;\n        try {\n            await huddle.disableWebcam();\n            setWebcamState(false);\n        } catch (error) {\n            alert(error);\n        }\n    };\n\n    const startScreenshare = async () => {\n        if (!huddle) return;\n        try {\n            await huddle.enableShare();\n            setScreenshareState(true);\n        } catch (error) {\n            alert(error);\n            setScreenshareState(false);\n        }\n    };\n\n    const stopScreenshare = async () => {\n        if (!huddle) return;\n        try {\n            await huddle.disableShare();\n            setScreenshareState(false);\n        } catch (error) {\n            alert(error);\n        }\n    };\n\n    //TODO: add muteMic() and unmuteMic()\n    const enableMic = async () => {\n        if (!huddle) return;\n        try {\n            huddle.enableMic();\n            setMicState(true);\n        } catch (error) {\n            setMicState(false);\n            alert(error);\n        }\n    };\n\n    const disableMic = async () => {\n        if (!huddle) return;\n        try {\n            huddle.disableMic();\n            setMicState(false);\n        } catch (error) {\n            alert(error);\n            setMicState(true);\n        }\n    };\n\n    const startRecording = async () => {\n        if (!huddle) return;\n        try {\n            const status = await huddle.startRecording();\n            if (status) console.log(\"recording successfully initiated\");\n        } catch (error) {\n            console.error(error);\n        }\n    };\n\n    const stopRecorder = async () => {\n        if (!huddle) return;\n        try {\n            const status = await huddle.stopRecording();\n            if (status) console.log(\"recording successfully stopped\");\n        } catch (error) {\n            console.error(error);\n        }\n    };\n\n    return (\n        <div className=\"App\">\n            <div className=\"me-ports\">\n                <video height=\"400px\" width=\"400px\" autoPlay ref={meVideoElem} />\n                <video height=\"400px\" width=\"400px\" autoPlay ref={meScreenElem} />\n            </div>\n            <div className=\"btn-grp\">\n                <button\n                    ref={joinRoomBtn}\n                    id=\"join-btn\"\n                    onClick={roomState === \"connected\" ? leaveRoom : joinRoom}\n                >\n                    {roomState === \"connected\" ? \"Leave Room\" : \"Join Room\"}\n                </button>\n                { }\n                <button onClick={webcamState ? disableWebcam : enableWebcam} disabled={!isHost}>\n                    {webcamState ? \"Disable Webcam\" : \"Enable Webcam\"}\n                </button>\n                <button onClick={micState ? disableMic : enableMic} disabled={!isHost}>\n                    {micState ? \"Disable Mic\" : \"Enable Mic\"}\n                </button>\n                <button onClick={screenshareState ? stopScreenshare : startScreenshare} disabled={!isHost}>\n                    {screenshareState ? \"Disable Screenshare\" : \"Enable Screenshare\"}\n                </button>\n                {/* <button onClick={toggleWebcam}>Toggle Webcam</button> */}\n            </div>\n\n            <div className=\"peer-ports\">\n                {consumerStreams.video.map((stream, idx) => {\n                    return <PeerVideo key={idx} videoTrack={getTrack(stream)} />;\n                })}\n                {consumerStreams.screen.map((stream, idx) => {\n                    return <PeerScreen key={idx} screenTrack={getTrack(stream)} />;\n                })}\n                {consumerStreams.audio.map((stream, idx) => {\n                    return <PeerAudio key={idx} audioTrack={getTrack(stream)} />;\n                })}\n            </div>\n        </div>\n    );\n}\n\nexport default Room;\n\n\n"]},"metadata":{},"sourceType":"module"}