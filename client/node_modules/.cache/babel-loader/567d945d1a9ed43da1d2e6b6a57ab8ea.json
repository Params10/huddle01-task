{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useAnimatedQRCodeReader = void 0;\n\nconst react_1 = __importStar(require(\"react\"));\n\nconst react_qr_reader_1 = __importDefault(require(\"react-qr-reader\"));\n\nconst bc_ur_1 = require(\"@cvbb/bc-ur\");\n\nconst events_1 = require(\"events\");\n\nconst Button_1 = require(\"../components/Button\");\n\nconst Progress_1 = require(\"../components/Progress\");\n\nconst ButtonGroup_1 = require(\"../components/ButtonGroup\");\n\nconst useAnimatedQRCodeReader = () => {\n  const [urCodes, setURCodes] = react_1.useState([]);\n  const [error, setError] = react_1.useState('');\n  const ee = react_1.useMemo(() => new events_1.EventEmitter(), []);\n  const [title, setTitle] = react_1.useState(null);\n  const [description, setDescription] = react_1.useState(null);\n\n  const reset = () => {\n    setURCodes([]);\n    setError('');\n  };\n\n  const processQRCode = qr => {\n    try {\n      processJSON(qr);\n    } catch (e1) {\n      try {\n        processUR(qr);\n      } catch (e2) {\n        processText(qr);\n      }\n    }\n  };\n\n  const handleStop = () => {\n    ee.emit('read', {\n      type: 'none',\n      result: ''\n    });\n  };\n\n  const handleRetry = () => {\n    reset();\n  };\n\n  const processJSON = data => {\n    JSON.parse(data);\n    ee.emit('read', {\n      type: 'json',\n      result: data\n    });\n  };\n\n  const processText = data => {\n    ee.emit('read', {\n      type: 'text',\n      result: data\n    });\n  };\n\n  const processUR = ur => {\n    try {\n      const [index, total] = bc_ur_1.extractSingleWorkload(ur);\n\n      if (urCodes.length > 0) {\n        const currentTotal = urCodes[0].total;\n\n        if (total !== currentTotal) {\n          setError('invalid animated qrcode: mismatching qrs, please retry');\n        }\n      }\n\n      if (!urCodes.find(item => item.index === index)) {\n        const newCodes = [...urCodes, {\n          index,\n          total,\n          data: ur\n        }];\n        setURCodes(newCodes);\n\n        if (newCodes.length === total) {\n          const result = bc_ur_1.decodeUR(newCodes.map(item => item.data));\n          ee.emit('read', {\n            type: 'ur',\n            result\n          });\n        }\n      }\n    } catch (e) {\n      setError(e.message);\n    }\n  };\n\n  const element = react_1.default.createElement(\"div\", {\n    style: {\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center'\n    }\n  }, title && react_1.default.createElement(\"p\", null, title), description && react_1.default.createElement(\"p\", null, description), react_1.default.createElement(react_qr_reader_1.default, {\n    onScan: data => {\n      if (data) {\n        processQRCode(data);\n      }\n    },\n    delay: 100,\n    style: {\n      width: '100%'\n    },\n    onError: e => {\n      setError(e.message);\n    }\n  }), react_1.default.createElement(\"p\", null, urCodes[0] && urCodes[0].total > 1 && react_1.default.createElement(Progress_1.Progress, {\n    progress: urCodes.length,\n    total: urCodes[0].total\n  })), react_1.default.createElement(ButtonGroup_1.ButtonGroup, null, react_1.default.createElement(Button_1.Button, {\n    onClick: handleStop\n  }, \"Close\"), error && react_1.default.createElement(Button_1.Button, {\n    onClick: handleRetry\n  }, \"Retry\")), error && react_1.default.createElement(\"p\", {\n    style: {\n      color: 'red'\n    }\n  }, error));\n  return [element, {\n    read: options => {\n      return new Promise(resolve => {\n        console.log(options);\n\n        if (options) {\n          options.title && setTitle(options.title);\n          options.description && setDescription(options.description);\n        }\n\n        ee.once('read', result => {\n          reset();\n          resolve(result);\n        });\n      });\n    }\n  }];\n};\n\nexports.useAnimatedQRCodeReader = useAnimatedQRCodeReader;","map":{"version":3,"sources":["../../lib/hooks/useAnimatedQRCodeReader.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useAnimatedQRCodeReader = void 0;\nconst react_1 = __importStar(require(\"react\"));\nconst react_qr_reader_1 = __importDefault(require(\"react-qr-reader\"));\nconst bc_ur_1 = require(\"@cvbb/bc-ur\");\nconst events_1 = require(\"events\");\nconst Button_1 = require(\"../components/Button\");\nconst Progress_1 = require(\"../components/Progress\");\nconst ButtonGroup_1 = require(\"../components/ButtonGroup\");\nconst useAnimatedQRCodeReader = () => {\n    const [urCodes, setURCodes] = react_1.useState([]);\n    const [error, setError] = react_1.useState('');\n    const ee = react_1.useMemo(() => new events_1.EventEmitter(), []);\n    const [title, setTitle] = react_1.useState(null);\n    const [description, setDescription] = react_1.useState(null);\n    const reset = () => {\n        setURCodes([]);\n        setError('');\n    };\n    const processQRCode = (qr) => {\n        try {\n            processJSON(qr);\n        }\n        catch (e1) {\n            try {\n                processUR(qr);\n            }\n            catch (e2) {\n                processText(qr);\n            }\n        }\n    };\n    const handleStop = () => {\n        ee.emit('read', {\n            type: 'none',\n            result: '',\n        });\n    };\n    const handleRetry = () => {\n        reset();\n    };\n    const processJSON = (data) => {\n        JSON.parse(data);\n        ee.emit('read', {\n            type: 'json',\n            result: data,\n        });\n    };\n    const processText = (data) => {\n        ee.emit('read', {\n            type: 'text',\n            result: data,\n        });\n    };\n    const processUR = (ur) => {\n        try {\n            const [index, total] = bc_ur_1.extractSingleWorkload(ur);\n            if (urCodes.length > 0) {\n                const currentTotal = urCodes[0].total;\n                if (total !== currentTotal) {\n                    setError('invalid animated qrcode: mismatching qrs, please retry');\n                }\n            }\n            if (!urCodes.find((item) => item.index === index)) {\n                const newCodes = [...urCodes, { index, total, data: ur }];\n                setURCodes(newCodes);\n                if (newCodes.length === total) {\n                    const result = bc_ur_1.decodeUR(newCodes.map((item) => item.data));\n                    ee.emit('read', {\n                        type: 'ur',\n                        result,\n                    });\n                }\n            }\n        }\n        catch (e) {\n            setError(e.message);\n        }\n    };\n    const element = (react_1.default.createElement(\"div\", { style: {\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n        } },\n        title && react_1.default.createElement(\"p\", null, title),\n        description && react_1.default.createElement(\"p\", null, description),\n        react_1.default.createElement(react_qr_reader_1.default, { onScan: (data) => {\n                if (data) {\n                    processQRCode(data);\n                }\n            }, delay: 100, style: { width: '100%' }, onError: (e) => {\n                setError(e.message);\n            } }),\n        react_1.default.createElement(\"p\", null, urCodes[0] && urCodes[0].total > 1 && react_1.default.createElement(Progress_1.Progress, { progress: urCodes.length, total: urCodes[0].total })),\n        react_1.default.createElement(ButtonGroup_1.ButtonGroup, null,\n            react_1.default.createElement(Button_1.Button, { onClick: handleStop }, \"Close\"),\n            error && react_1.default.createElement(Button_1.Button, { onClick: handleRetry }, \"Retry\")),\n        error && react_1.default.createElement(\"p\", { style: { color: 'red' } }, error)));\n    return [\n        element,\n        {\n            read: (options) => {\n                return new Promise((resolve) => {\n                    console.log(options);\n                    if (options) {\n                        options.title && setTitle(options.title);\n                        options.description && setDescription(options.description);\n                    }\n                    ee.once('read', (result) => {\n                        reset();\n                        resolve(result);\n                    });\n                });\n            },\n        },\n    ];\n};\nexports.useAnimatedQRCodeReader = useAnimatedQRCodeReader;\n//# sourceMappingURL=useAnimatedQRCodeReader.js.map"]},"metadata":{},"sourceType":"script"}